# elm„Çívim„ÅßÊõ∏„Åè with language server
[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server) „ÅÆÂÆüË£Ö„ÅåÈÄ≤„Çì„Åß„Åç„Å¶„ÄÅÂÆöÁæ©„Å∏„ÅÆ„Ç∏„É£„É≥„Éó„ÇÑhover„Å™„Å©„ÅåÂèØËÉΩ„Å´„Å™„Å£„Åü„ÄÇ

ÊôÆÊÆµ„ÅØvim‰Ωø„Å£„Å¶„Çã„Åë„Å©elmÊõ∏„Åè„Å®„Åç„Å†„Åë„ÅØatom„Å™„Çì„Å†„Çà„Å™„ÄÇ„ÄÇ„Å®„ÅÑ„ÅÜ‰∫∫„ÅÆÂèÇËÄÉ„Å´„Å™„Çå„Å∞„ÅÑ„ÅÑ„Å™„Å®ÊÄù„ÅÜ„ÄÇ

‰ªäÂõû„ÅØ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊñπÊ≥ï‰∏≠ÂøÉ„Å´Êõ∏„ÅÑ„Å¶„ÅÑ„Åè„ÄÇ

## Áí∞Â¢É
```
$ node -v
v11.12.0

$ npm --version
6.7.0

$ elm --version
0.19.0
$ elm-format --help
elm-format 0.8.1
$ elm-test --version
0.19.0-rev6

$ vim -v
NVIM v0.4.0-dev
```

## „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
### syntax
neovim/vim „Å®„ÇÇ„Å´Âü∑Á≠ÜÁèæÂú®„ÅØelm„ÅÆ„Åü„ÇÅ„ÅÆsyntax„ÅØdefault„Åß„ÅØÂÖ•„Å£„Å¶„ÅÑ„Å™„ÅÑ
* [neovim/runtime/syntax at master ¬∑ neovim/neovim](https://github.com/neovim/neovim/tree/master/runtime/syntax)
* [vim/runtime/syntax at master ¬∑ vim/vim](https://github.com/vim/vim/tree/master/runtime/syntax)

syntax„ÅÆplugin„ÇíÂÖ•„Çå„Å¶„ÄÅÊ∞óÊåÅ„Å°„Çà„ÅèÈñãÁô∫„Åó„Åü„ÅÑ„ÄÇ

[ElmCast/elm\-vim: Elm plugin for Vim](https://github.com/ElmCast/elm-vim)

„Åì„ÅÆplugin„ÇíÂà©Áî®„Åó„Å¶elm„ÅÆsyntax„ÇíÊúâÂäπ„Å´„Åô„Çã

vim-plug„ÇíÁî®„ÅÑ„Åüplugin install„ÅÆ‰æã„ÅØ‰ª•‰∏ã

```
Plug 'ElmCast/elm-vim', { 'for': 'elm' }
```

[![ss](https://raw.githubusercontent.com/cappyzawa/demo/master/elm-vim/elm-vim.png)](.)

„Å†„ÅÑ„Å∂Ë¶ã„ÇÑ„Åô„Åè„Å™„Å£„Åü„ÄÇsytax„ÇíÊúâÂäπ„Å´„Åó„Åü„ÅÑ„Å†„Åë„Å†„Åã„Çâdefault„ÅÆkeybinding„ÅØÁÑ°Âäπ„Å´„Åó„Å¶„Åä„Åè„ÄÇ
```
let g:elm_setup_keybindings = 0
```

### Lsp Server
[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server)

```
$ git clone https://github.com/elm-tooling/elm-language-server.git
$ cd elm-language-server
$ git rev-parse HEAD
78aca21bd308bfc33540ef0c90b275ea4aaa4eb1
$ npm install
$ npm run compile
$ npm link

$ source ~/.zshrc
$ which elm-language-server
/Users/cappyzawa/.anyenv/envs/nodenv/shims/elm-language-server
```

`elm-language-server` „Ç≥„Éû„É≥„Éâ„Å´PATH„ÅåÈÄö„Å£„Å¶„ÅÑ„Çå„Å∞OK

### Lsp Client
vim„ÅßÂà©Áî®„Åß„Åç„ÇãLsp Client„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„ÇÇ„ÅÆ„Åå„ÅÇ„Çã
* [neoclide/coc\.nvim: Intellisense engine for vim8 & neovim, full language server protocol support as VSCode](https://github.com/neoclide/coc.nvim)
* [prabirshrestha/vim\-lsp: async language server protocol plugin for vim and neovim](https://github.com/prabirshrestha/vim-lsp)
* [autozimu/LanguageClient\-neovim: Language Server Protocol \(LSP\) support for vim and neovim\.](https://github.com/autozimu/LanguageClient-neovim)

ÁµêÂ±Ä„ÅØelm„ÅÆfile„ÇíÁ∑®ÈõÜ„Åô„Çã„Å®„Åç„Å´ `elm-language-server --stdio` „Ç≥„Éû„É≥„Éâ„ÅåÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çå„Å∞„ÅÑ„ÅÑ„Åã„Çâ„ÅäÂ•Ω„Åç„Å™„ÇÇ„ÅÆ„ÇíÈÅ∏„Åπ„Å∞„ÅÑ„ÅÑ„ÄÇ

coc.nvim„ÅÆË®≠ÂÆö„ÅØ[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server#vim) „Å´Êõ∏„ÅÑ„Å¶„ÅÑ„ÇãÈÄö„Çä„Å™„ÅÆ„Åß„ÄÅ‰ªäÂõû„ÅØvim-lsp„ÅßË®≠ÂÆö„Åó„Å¶„Åø„Çã(ÊôÆÊÆµ„ÅØcoc.nvim„Å™„Çì„Å†„Åå„ÄÇ„ÄÇ)

„Åæ„ÅüREADME„Å´„ÅØ[w0rp/ale](https://github.com/w0rp/ale)„Çí‰Ωø„ÅÜ‰æã„ÇÇ„ÅÇ„Çã„Åå„ÄÅlint/format„ÅØ‰∏äË®ò„ÅÆlsp-client„Å†„Åë„Åß„ÇÇËß£Ê±∫„Åß„Åç„Çã„ÄÇ(„Å§„Åæ„Çä[antew/vim\-elm\-language\-server](https://github.com/antew/vim-elm-language-server) „ÅØ„ÅÑ„Çå„Å™„Åè„Å¶„ÇÇÂ§ß‰∏àÂ§´)

‰ª•‰∏ã„ÇíËøΩÂä†
```
if executable('elm-language-server')
  au User lsp_setup call lsp#register_server({
    \ 'name': 'elm-language-server',
    \ 'cmd': {server_info->[&shell, &shellcmdflag, 'elm-language-server --stdio']},
    \ 'initialization_options': {
      \ 'runtime': 'node',
      \ 'elmPath': 'elm',
      \ 'elmFormatPath': 'elm-format',
      \ 'elmTestPath': 'elm-test',
      \ 'rootPatterns': 'elm.json'
      \ },
    \ 'whitelist': ['elm'],
    \ })
  autocmd BufWritePre *.elm LspDocumentFormat
endif
```

`autocmd BufWritePre`„ÇíË®≠ÂÆö„Åó„Å¶„ÅÑ„Çã„Åì„Å®„Å´„Çà„Çä„ÄÅ„Éï„Ç°„Ç§„É´Êõ∏„ÅçËæº„ÅøÂâç„Å´`elm-format`„Åå„Åã„Åã„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Çã„ÄÇ

„ÅÇ„Å®„ÅØelm„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÈñã„ÅÑ„Å¶lsp-client„ÅÆ„Ç≥„Éû„É≥„Éâ„ÇíÂè©„ÅÑ„Å¶‰ΩøÁî®ÊÑü„ÇíÁ¢∫„Åã„ÇÅ„Çå„Å∞ËâØ„ÅÑ„ÄÇ

Âà©Áî®ÂèØËÉΩ„Å™„Ç≥„Éû„É≥„Éâ: [prabirshrestha/vim\-lsp#SupportedCommands](https://github.com/prabirshrestha/vim-lsp#supported-commands)

## ‰ªòÈå≤
language-server„ÅÆsupport action„ÅÆ‰∏ÄË¶ß => [Langserver\.org](https://langserver.org/)

vim x LSP„Çí„ÇÇ„Å£„Å®Áü•„Çä„Åü„ÅÑ => [LSP„Åã„Çô„ÇÇ„Åü„Çâ„Åó„ÅüVim„Éï„Çö„É©„ÇØ„Çô„Ç§„É≥„ÅÆÂ§âÂåñ„Å´ÊÄù„ÅÑ„ÇíÈ¶≥„Åõ„Çã \- Speaker Deck](https://speakerdeck.com/lighttiger2505/lspkamotarasitavimhurakuinfalsebian-hua-nisi-iwochi-seru)

elm-language-server„ÅÆÂãïÂêë„ÇíÁü•„Çä„Åü„ÅÑ => [#elm-language-server - Slack](https://elmlang.slack.com/messages/C6ZRS3ALU)

Elm-jp => [Elm\-jp](https://elm-lang.jp/)

## ËøΩË®ò
ÊôÆÊÆµ„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Åó„Å¶plugin„ÅÆ‰Ωè„ÅøÂàÜ„Åë„Çí„Åó„Å¶„ÅÑ„Çã
* lint/format:[ale/ale\.vim at master ¬∑ w0rp/ale](https://github.com/w0rp/ale/blob/master/plugin/ale.vim)
* ÂÆöÁæ©jump„Å™„Å©: [neoclide/coc\.nvim: Intellisense engine for vim8 & neovim, full language server protocol support as VSCode](https://github.com/neoclide/coc.nvim)

„ÇΩ„Éº„Çπ„ÅØ [dotfiles/\.vim at master ¬∑ cappyzawa/dotfiles](https://github.com/cappyzawa/dotfiles/tree/master/.vim) „Å†„Åå„ÄÅ„Åù„Çå„Åû„Çå„Å´Èñ¢„Åô„Çã„Å®„Åì„Çç„ÇíÊäúÁ≤ã„Åó„Å¶„Ç≥„Éî„Éö„Åô„Çå„Å∞(„Åü„Å∂„Çì)„Åù„Çå„Å™„Çä„Å´‰Ωø„Åà„Çã„Ç≥„Éº„Éâ„ÇíË≤º„Å£„Å¶„Åä„Åè

plugin„ÅÆinstall
```
Plug 'neoclide/coc.nvim', {'do': { -> coc#util#install()}}
Plug 'w0rp/ale'
Plug 'ElmCast/elm-vim', { 'for': 'elm' }
```

ÂêÑÁ®ÆË®≠ÂÆö
```
let g:ale_fix_on_save = 1
let g:ale_set_quickfix = 1
let g:ale_sign_error = 'üî•'
let g:ale_sign_warning = '‚ö°Ô∏è'
let g:ale_echo_msg_error_str = 'üî•'
let g:ale_echo_msg_warning_str = '‚ö°Ô∏è'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let g:ale_fixers = {
\   'elm': ['elm-format'],
\}

" for elm
let g:ale_elm_format_executable = 'elm-format'
let g:ale_elm_format_options = '--yes --elm-version=0.19'

nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gy <Plug>(coc-type-definition)
nmap <silent> gi <Plug>(coc-implementation)
nmap <silent> gr <Plug>(coc-references)
nmap <silent> gt <Plug>(coc-rename)
nnoremap <silent> gk :call <SID>show_documentation()<CR>

function! s:show_documentation()
  if &filetype ==# 'vim'
    execute 'h '.expand('<cword>')
  else
    if coc#util#has_float()
      pc
    else
      call CocActionAsync('doHover')
    endif
  endif
endfunction
```

`:CocConfig`
```
{
  "suggest.triggerAfterInsertEnter": true,
  "suggest.noselect": false,
  "suggest.minTriggerInputLength": 2,
  "suggest.acceptSuggestionOnCommitCharacter": true,
  "suggest.snippetIndicator": " ‚ñ∫",
  "suggest.enablePreview": true,
  "coc.preferences.hoverTarget": "float",
  "coc.preferences.diagnostic.displayByAle": true,
  "list.autoResize": true,
  "languageserver": {
    "elmLS": {
      "command": "elm-language-server",
      "args": [
        "--stdio"
      ],
      "filetypes": [
        "elm"
      ],
      "rootPatterns": [
        "elm.json"
      ],
      "initializationOptions": {
        "runtime": "node",
        "elmPath": "elm",
        "elmFormatPath": "elm-format"
      }
    }
  }
}
```
